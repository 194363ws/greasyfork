<%=form_for(script_version.script.new_record? ? script_version : [script_version.script, script_version]) do |s|%>
	<% disallowed_requires = script_version.disallowed_requires_used

	if !script_version.errors.empty? or !script_version.script.errors.empty? or !disallowed_requires.empty? %>
		<p>There were some problems with what you posted...</p>
		<ul class="errors">
			<% script_version.errors.full_messages.each do |m| 
				# skip @require validation in favour of the next block
				if !(m.include?('Code cannot @require') and !disallowed_requires.empty?) %>
					<li><%=m%></li>
				<% end
			end
			script_version.script.errors.full_messages.each do |m| %>
				<li><%=m%></li>
			<% end
			if !disallowed_requires.empty? %>
				<li>You are using <code>@require</code>s outside of Greasy Fork's whitelist: <%=disallowed_requires.join(', ')%>. Check <label for="script_version_accepted_assessment">this box</label> <%=s.check_box(:accepted_assessment, {}, true, false)%> and save if you would like your <code>@require</code>s assessed by an admin. <%=link_to 'Read Greasy Fork\'s policy on <code>@require</code>.'.html_safe, help_code_rules_path(:anchor => 'require'), {:target => 'code_rules'}%></li>
			<% end %>
		</ul>
	<% end %>

	<div class="form-control">
		<label for="code">Code</label> <%=link_to '(Read the rules)', help_code_rules_path, {:target => 'code_rules', :class => 'label-note'}%><br>
		<%=s.text_area(:code)%>
	</div>
	<% if !script_version.script.new_record? %>
		<div class="form-control">
			<label for="changelog">Changelog</label> <span class="label-note">What's changed in this version?</span><br>
			<%=s.text_field(:changelog, :maxlength => 500, :size => nil)%>
		</div>
	<% end %>
	<div class="form-control">
		<label for="additional-info">Additional info</label>
		<span class="label-note">
			Ramble on about your script.
			<%=s.radio_button(:additional_info_markup, 'html')%> <%=link_to 'HTML', help_allowed_markup_path, {:target => 'markup_choice'}%>
			<%=s.radio_button(:additional_info_markup, 'markdown')%> <%=link_to 'Markdown', 'http://daringfireball.net/projects/markdown/basics', {:target => 'markup_choice'}%>
			<button id="preview-script-additional-info" class="preview-button">Preview</button>
		</span><br>
		<%=s.text_area(:additional_info, {:class => 'previewable', 'data-preview-activate-id' => 'preview-script-additional-info', 'data-markup-option-name' => 'script_version[additional_info_markup]', 'data-preview-result-id' => 'preview-script-additional-info-results'})%>
		<div id="preview-script-additional-info-results" class="preview-result"></div>
	</div>
	<%=s.submit(script_version.script.new_record? ? 'Post script' : 'Post new version')%>
<% end %>
